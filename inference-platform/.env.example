# ===================================
# Enterprise Inference Gateway Config
# ===================================

# === API Keys ===
# Public key clients send to your gateway
GATEWAY_API_KEY=CHANGE_ME_STRONG_KEY_HERE

# Internal key gateway uses to call vLLM backends
BACKEND_API_KEY=INTERNAL_ONLY_CHANGE_ME_HERE

# Optional HuggingFace token if any model is gated
HUGGING_FACE_HUB_TOKEN=

# === HuggingFace Cache ===
# Path on host to persist model downloads
HF_HOME=./hf-cache

# === Backend URLs ===
# Comma-separated list of chat backend URLs (load-balanced)
CHAT_BACKENDS=http://chat0:8000,http://chat1:8000

# Text2SQL backend URL
TEXT2SQL_BACKEND=http://text2sql:8000

# Embeddings backend URL
EMBED_BACKEND=http://embed:8000

# Rerank backend URL
RERANK_BACKEND=http://rerank:8000

# === Rate Limiting (Per Organization IP) ===
# Allow ~50 requests/sec per org IP
MAX_RPS_PER_IP=50
RPS_WINDOW_SECS=1
RPS_BURST=100

# === Concurrency Control (Per Organization IP) ===
# Allow high concurrency per org IP (one chat fans out into many calls)
MAX_INFLIGHT_PER_IP=120

# Queueing timeout (admission only). If no slot within this -> 429
QUEUE_TIMEOUT_SECS=2

# === Request Timeouts ===
# Hard cap total request lifetime (protects against infinite sockets)
MAX_REQUEST_SECS=5400          # 90 minutes

# If streaming produces no bytes for this long -> cut the stream
STREAM_IDLE_TIMEOUT_SECS=180   # 3 minutes

# === Quota Management ===
# Daily token limit per organization
ORG_DAILY_TOKEN_LIMIT=10000000    # 10M tokens/day

# Daily request limit per organization
ORG_DAILY_REQUEST_LIMIT=100000    # 100k requests/day

# Monthly token limit per organization
ORG_MONTHLY_TOKEN_LIMIT=300000000 # 300M tokens/month

# === Caching ===
# Cache TTL in seconds
CACHE_TTL_SECS=60

# Maximum cache size (number of entries)
CACHE_MAX_SIZE=10000

# === Circuit Breaker ===
# Number of failures before opening circuit
CIRCUIT_FAILURE_THRESHOLD=5

# Seconds to wait before trying again
CIRCUIT_RECOVERY_TIMEOUT=30

# === Health Checks ===
# Interval between health checks (seconds)
HEALTH_CHECK_INTERVAL_SECS=10

# Health check timeout (seconds)
HEALTH_CHECK_TIMEOUT_SECS=2

# === Logging ===
# Log level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# Enable PII redaction in logs
ENABLE_PII_REDACTION=true

# === Gateway Workers ===
# Number of uvicorn workers
GATEWAY_WORKERS=4
